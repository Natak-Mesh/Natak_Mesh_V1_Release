# Mesh Configuration Directory

This directory contains the core configuration files and scripts for establishing a secure BATMAN-adv mesh network with MACsec encryption. These files work together to create a resilient mesh network infrastructure that supports the Reticulum Network Stack.

## File Overview

### batmesh.sh
A shell script that configures and initializes the BATMAN-adv mesh network. This script:
- Loads configuration parameters from mesh_config.env
- Configures network interfaces to be unmanaged by NetworkManager
- Loads the batman-adv kernel module and sets the routing algorithm to BATMAN_V
- Configures the wireless interface (wlan1) for mesh operation
- Sets up bridge interfaces and MTU values
- Applies BATMAN-adv optimizations for Mobile Ad-hoc Network (MANET) deployment:
  - OGM interval adjustment for better mobility adaptation
  - Hop penalty settings to favor stronger direct links
  - Network coding for improved throughput
  - Distributed ARP table to reduce broadcast traffic

### macsec.sh
A shell script that configures MACsec (IEEE 802.1AE) encryption for the mesh network. This file is generated by the MACsec configurator program located in the macsec_config_tool directory. The script:
- Sets appropriate MTU values for interfaces
- Creates a MACsec interface linked to wlan1
- Configures encryption keys for the local node
- Sets up reception ports and keys for peer nodes
- Enables the MACsec interface

Note: This file contains security-sensitive encryption keys and should be protected accordingly.

### mesh_config.env
An environment configuration file that contains parameters used by the batmesh.sh script. Key parameters include:
- MESH_NAME: The mesh network identifier (SSID)
  - Must be identical across all nodes in the mesh network
- MESH_CHANNEL: The wireless channel for mesh operation
  - All nodes must operate on the same channel
  - Includes commented options for various 2.4 GHz and 5 GHz channels
  - To change channels, comment out the current channel and uncomment the desired channel

### hostname_mapping.json
A JSON configuration file that maps MAC addresses to hostnames and IP addresses. This file is also generated by the MACsec configurator program. The file contains:
- A Reticulum group key for secure group communications
- A "nodes" object mapping MAC addresses to:
  - hostname: The human-readable node identifier
  - ip: The static IP address assigned to the node

This mapping is essential for both the MACsec configuration and the Reticulum Network Stack's peer discovery mechanism.

## Usage

These files are typically deployed to Raspberry Pi devices and executed during system startup via systemd services. The batmesh.sh script depends on the macsec.sh script having been executed first to establish the encrypted layer.

For details on generating the macsec.sh and hostname_mapping.json files, refer to the documentation in the macsec_config_tool directory.
